"use strict";(()=>{var e={};e.id=950,e.ids=[950],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},9160:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>A,patchFetch:()=>T,requestAsyncStorage:()=>b,routeModule:()=>x,serverHooks:()=>C,staticGenerationAsyncStorage:()=>k});var a={};n.r(a),n.d(a,{GET:()=>$,POST:()=>g});var r=n(49303),i=n(88716),s=n(60670),o=n(87070);function c(e){let t=e.toLowerCase().trim();return["watch","alert","notify","tell me when","let me know when"].some(e=>t.includes(e))?function(e){let t=e.match(/(?:watch|alert|notify)(?:\s+(?:for|me|when))?\s+(?:(\d+)\s+)?(?:tickets?\s+)?(?:for\s+)?(?:to\s+)?([^€\n]+?)(?:\s+(?:under|below|max|less than|<)?\s*€?(\d+))?$/i),n=null,a=1,r=null;return t&&(a=t[1]?parseInt(t[1]):1,n=t[2]?.trim()||null,r=t[3]?parseFloat(t[3]):null),{intent:"watch",confidence:n?.7:.5,eventName:n,maxPrice:r,quantity:a,needsClarification:!n,clarificationMessage:n?null:"What event do you want to watch for?"}}(e):["cancel","stop","remove","unwatch"].some(e=>t.includes(e))?function(e){let t=e.match(/cancel(?:\s+(?:watch|for))?\s+([^.!?\n]+)?/i),n=t?.[1]?.trim()||null;return{intent:"cancel",confidence:.8,eventName:n,needsClarification:!n,clarificationMessage:n?null:"Which watch do you want to cancel? (or 'my watches' to see all)"}}(e):["my watches","list","what am i","check my","active"].some(e=>t.includes(e))?{intent:"list",confidence:.9,needsClarification:!1}:["update","any","news","status","tickets available"].some(e=>t.includes(e))?{intent:"status",confidence:.8,needsClarification:!1}:["yes","yeah","yep","confirm","go ahead","do it"].some(e=>t.includes(e))?{intent:"confirm",confidence:.9,needsClarification:!1}:["no","nah","nevermind","skip"].some(e=>t.includes(e))?{intent:"deny",confidence:.9,needsClarification:!1}:["gig","concert","event","playing","what's","show","tour"].some(e=>t.includes(e))?{intent:"search",confidence:.7,query:e,needsClarification:!1}:["help","how","?"].some(e=>t.includes(e))?{intent:"help",confidence:.9,needsClarification:!1}:{intent:"search",confidence:.5,query:e,needsClarification:!1}}var l=n(26039),u=n(11111);async function d(e,t,n){await (0,l.r4)(e,t);let a=await (0,l.BZ)(e);if(a?.action==="confirm_watch"){let t=c(n);if("confirm"===t.intent)return h(e,a.data);if("deny"===t.intent)return await (0,l.yL)(e,null),"No worries, watch cancelled. Send another message anytime!";await (0,l.yL)(e,null)}let r=c(n);switch(r.intent){case"search":return w(r);case"watch":return f(e,r);case"list":return m(e);case"cancel":return p(e,r);case"status":return y(e);case"help":return'*TicketWatch Help*\n\nI help you find and watch for sold-out concert tickets in Ireland!\n\n*Commands:*\n- "Watch for [artist] under €[price]" - Create a ticket watch\n- "My watches" - See your active watches\n- "Cancel [artist]" - Remove a watch\n- "[Artist name]" - Search for events\n- "Any updates?" - Check your watches for new tickets\n\n*Pricing:*\nFree: 1 active watch\nPremium (€4.99/mo): Unlimited watches\n\nSay \'watch for Bicep under €75\' to start!';default:return"Sorry, I didn't understand that. Send 'help' to see what I can do."}}async function w(e){let t=e.query;if(!t)return"What events are you looking for?";let n=await (0,u.gT)(t,5);if(!n.length)return`No events found for '${t}'. Try a different artist or venue name.`;let a=n.slice(0,5).map(u.Dt).filter(Boolean),r=[`Found ${a.length} events:
`];return a.forEach((e,t)=>{if(!e)return;let n="onsale"===e.status?"[ON SALE]":"[OFF SALE]",a=e.priceMin?`€${e.priceMin}-€${e.priceMax}`:"TBA";r.push(`${t+1}. *${e.name}*
   ${e.venue}, ${e.city}
   ${e.date} ${e.time}
   ${a}
   ${n}`)}),r.push("\nWant to watch for any of these? Say 'watch for [event] under €[price]'"),r.join("\n")}async function f(e,t){if(t.needsClarification)return t.clarificationMessage||"What event do you want to watch for?";let n=t.eventName,a=t.maxPrice,r=t.quantity||1,i=await (0,l.ov)(e),s=await (0,l.fd)(e);if("free"===i&&s>=1)return`You're on the free tier (max 1 watch). You already have ${s} active watch. Cancel one or upgrade to Premium (€4.99/mo) for unlimited watches.`;let o=await (0,u.gT)(n,3);if(!o.length)return`Couldn't find '${n}'. Check spelling or try searching first.`;let c=o[0],d=(0,u.Dt)(c);if(!d)return"Error processing event data. Try again.";let w=d.priceMin?` (currently €${d.priceMin}-€${d.priceMax})`:"",f=a?` under €${a}`:"";return await (0,l.yL)(e,{action:"confirm_watch",data:{eventId:c.id,eventName:d.name,venue:d.venue,date:d.date,maxPrice:a,quantity:r,buyUrl:d.url}}),`Confirm your watch:

*${d.name}*${w}
${d.venue} (${d.city})
${d.date}
Alert me for ${r}x tickets${f}
Current status: ${d.status}

Reply with 'yes' to confirm or 'no' to skip.`}async function h(e,t){if(await (0,l.yL)(e,null),!await (0,l.bv)(e,t.eventId,t.eventName,t.venue,t.date,t.maxPrice,t.quantity,t.buyUrl))return`You're already watching ${t.eventName}. Cancel it first if you want to change the price.`;let n=t.maxPrice?` under €${t.maxPrice}`:"";return`Watch created for ${t.eventName}!
I'll alert you on WhatsApp when ${t.quantity}x ticket(s) are available${n}.

Reply with 'my watches' to see your active watches.`}async function m(e){let t=await (0,l.W7)(e,"active");if(!t.length)return"You don't have any active watches.\nStart with: 'Watch for [event] under €[price]'";let n=["Your active watches:\n"];return t.forEach(e=>{let t=e.maxPrice?` (max €${e.maxPrice})`:"",a=new Date(e.createdAt).toLocaleDateString("en-IE",{day:"numeric",month:"short"});n.push(`- ${e.eventName}${t}
  ${e.quantity}x tickets, created ${a}`)}),n.push("\nReply 'cancel [event]' to remove a watch."),n.join("\n")}async function p(e,t){if(t.needsClarification)return"Which watch do you want to cancel?\nReply with: 'cancel [event name]'";let n=t.eventName,a=(await (0,l.W7)(e,"active")).find(e=>e.eventName.toLowerCase().includes(n.toLowerCase()));return a?(await (0,l.Sr)(a._id.toString()),`Cancelled watch for ${a.eventName}.`):`Didn't find a watch for '${n}'.
Reply 'my watches' to see your active ones.`}async function y(e){let t=await (0,l.W7)(e,"active");if(!t.length)return"You don't have any active watches yet.";let n=["Checking your watches...\n"];for(let e of t){let t=await (0,u.gR)(e.eventId,e.maxPrice,e.quantity);t.available?n.push(`*${e.eventName}* - TICKETS AVAILABLE!
   Price: €${t.price}
   ${t.details}`):n.push(`${e.eventName}: ${t.details}`)}return n.join("\n")}var v=n(52013);async function g(e){try{let t=await e.formData(),n=t.get("From"),a=t.get("Body");if(!n||!a)return new o.NextResponse("Missing From or Body",{status:400});let r=n.replace("whatsapp:","");console.log(`Incoming WhatsApp from ${r}: ${a}`);let i=await d(n,r,a);return new o.NextResponse((0,v.SU)(i),{headers:{"Content-Type":"text/xml"}})}catch(e){return console.error("Webhook error:",e),new o.NextResponse((0,v.SU)("Sorry, something went wrong. Please try again."),{headers:{"Content-Type":"text/xml"}})}}async function $(){return o.NextResponse.json({status:"ok",service:"TicketWatch WhatsApp Bot"})}let x=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/webhook/twilio/route",pathname:"/api/webhook/twilio",filename:"route",bundlePath:"app/api/webhook/twilio/route"},resolvedPagePath:"C:\\Users\\dylan\\OneDrive\\Desktop\\dylan-portfolio\\ticketwatch\\app\\api\\webhook\\twilio\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:b,staticGenerationAsyncStorage:k,serverHooks:C}=x,A="/api/webhook/twilio/route";function T(){return(0,s.patchFetch)({serverHooks:C,staticGenerationAsyncStorage:k})}},26039:(e,t,n)=>{n.d(t,{Sr:()=>g,fd:()=>$,r4:()=>u,bv:()=>m,cQ:()=>y,BZ:()=>h,PR:()=>d,ov:()=>w,W7:()=>p,Iw:()=>x,yL:()=>f,qk:()=>v});let a=require("mongodb"),r=process.env.MONGODB_URI||"";r||console.warn("MONGODB_URI not set - database operations will fail");let i=null;async function s(){if(i)return i.db;let e=new a.MongoClient(r);await e.connect();let t=e.db("ticketwatch");return i={client:e,db:t},t}async function o(){return(await s()).collection("users")}async function c(){return(await s()).collection("watches")}async function l(){return(await s()).collection("alerts")}async function u(e,t){let n=await o();await n.updateOne({_id:e},{$set:{phone:t,lastActivity:new Date},$setOnInsert:{tier:"free",createdAt:new Date,conversationState:null}},{upsert:!0})}async function d(e){return(await o()).findOne({_id:e})}async function w(e){let t=await d(e);return t?.tier||"free"}async function f(e,t){let n=await o();await n.updateOne({_id:e},{$set:{conversationState:t}})}async function h(e){let t=await d(e);return t?.conversationState||null}async function m(e,t,n,a,r,i,s,o){let l=await c();return await l.findOne({userId:e,eventId:t,status:"active"})?null:(await l.insertOne({userId:e,eventId:t,eventName:n,venue:a,dateStart:r,maxPrice:i,quantity:s,status:"active",buyUrl:o,createdAt:new Date,lastChecked:null,alertedAt:null})).insertedId.toString()}async function p(e,t="active"){return(await c()).find({userId:e,status:t}).sort({createdAt:-1}).toArray()}async function y(){return(await c()).find({status:"active"}).sort({lastChecked:1}).toArray()}async function v(e,t){let n=await c();await n.updateOne({_id:new a.ObjectId(e)},{$set:{status:t,lastChecked:new Date}})}async function g(e){let t=await c();await t.updateOne({_id:new a.ObjectId(e)},{$set:{status:"cancelled"}})}async function $(e){return(await c()).countDocuments({userId:e,status:"active"})}async function x(e,t,n,r){let i=await l();await i.insertOne({watchId:new a.ObjectId(e),userId:t,eventName:n,currentPrice:r,sentAt:new Date});let s=await c();await s.updateOne({_id:new a.ObjectId(e)},{$set:{status:"alerted",alertedAt:new Date}})}},11111:(e,t,n)=>{n.d(t,{Dt:()=>l,gR:()=>u,gT:()=>o});let a=process.env.TICKETMASTER_API_KEY||"",r="https://app.ticketmaster.com/discovery/v2",i=!a,s=[{id:"Z698xZaZeEe11",name:"Fred Again",dates:{start:{localDate:"2026-03-15",localTime:"20:00"},status:{code:"onsale"}},_embedded:{venues:[{name:"3Arena Dublin",city:{name:"Dublin"}}]},priceRanges:[{min:65,max:145}],url:"https://www.ticketmaster.ie/fred-again-dublin-03-15-2026/event/12345"},{id:"Z123xZaZeEe22",name:"The 1975",dates:{start:{localDate:"2026-04-20",localTime:"19:30"},status:{code:"offsale"}},_embedded:{venues:[{name:"O2 Dublin",city:{name:"Dublin"}}]},priceRanges:[{min:75,max:125}],url:"https://www.ticketmaster.ie/the-1975-dublin-04-20-2026/event/67890"},{id:"Z456xZaZeEe33",name:"Electric Picnic",dates:{start:{localDate:"2026-09-05",localTime:"11:00"},status:{code:"offsale"}},_embedded:{venues:[{name:"Laois Picnic",city:{name:"Laois"}}]},priceRanges:[{min:125,max:185}],url:"https://www.ticketmaster.ie/electric-picnic-laois-09-05-2026/event/11111"}];async function o(e,t=10){if(i){let t=e.toLowerCase(),n=s.filter(e=>e.name.toLowerCase().includes(t));return n.length>0?n:s.slice(0,3)}let n=new URLSearchParams({apikey:a,keyword:e,countryCode:"IE",size:String(t),sort:"date,asc"});try{let e=await fetch(`${r}/events.json?${n}`,{signal:AbortSignal.timeout(1e4)});if(!e.ok)return[];let t=await e.json();return t?._embedded?.events||[]}catch{return[]}}async function c(e){if(i)return s.find(t=>t.id===e)||null;let t=new URLSearchParams({apikey:a});try{let n=await fetch(`${r}/events/${e}.json?${t}`,{signal:AbortSignal.timeout(1e4)});if(!n.ok)return null;return n.json()}catch{return null}}function l(e){if(!e)return null;let t="TBA",n="";e._embedded?.venues?.[0]&&(t=e._embedded.venues[0].name||"TBA",n=e._embedded.venues[0].city?.name||"");let a=e.dates?.start||{},r=e.priceRanges?.[0]?.min??null,i=e.priceRanges?.[0]?.max??null,s=e.dates?.status?.code||"unknown";return{id:e.id,name:e.name,venue:t,city:n,date:a.localDate||"TBA",time:a.localTime||"",priceMin:r,priceMax:i,status:s,url:e.url||""}}async function u(e,t,n){let a=await c(e);if(!a)return{available:!1,status:"not_found",details:"Event not found"};let r=a.dates?.status?.code||"unknown";if("onsale"!==r)return{available:!1,status:r,details:`Event status: ${r}`};let i=a.priceRanges||[];if(!i.length)return{available:!1,status:"no_pricing",details:"No pricing information available"};let s=i[0].min,o=i[0].max;return t&&s?s<=t?{available:!0,status:"onsale",price:s,priceMax:o,details:`Tickets available from €${s}`}:{available:!1,status:"above_target",price:s,details:`Cheapest ticket €${s} (your target: €${t})`}:{available:!0,status:"onsale",price:s,priceMax:o,details:`Tickets available from €${s}`}}},52013:(e,t,n)=>{n.d(t,{SU:()=>u,Zv:()=>l});var a=n(5558),r=n.n(a);let i=process.env.TWILIO_ACCOUNT_SID||"",s=process.env.TWILIO_AUTH_TOKEN||"",o=process.env.TWILIO_WHATSAPP_NUMBER||"whatsapp:+14155238886",c=null;async function l(e,t){try{let n=function(){if(!c){if(!i||!s)throw Error("TWILIO_ACCOUNT_SID and TWILIO_AUTH_TOKEN must be set");c=r()(i,s)}return c}(),a=await n.messages.create({from:o,to:e.startsWith("whatsapp:")?e:`whatsapp:${e}`,body:t});return{success:!0,sid:a.sid}}catch(e){return console.error("Twilio send error:",e.message),{success:!1,error:e.message}}}function u(e){let t=new(r()).twiml.MessagingResponse;return t.message(e),t.toString()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[276,242],()=>n(9160));module.exports=a})();